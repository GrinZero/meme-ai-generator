# 微信表情标准化 - 选择性生成功能改进计划

## 目标

实现 P1-P5 图片的细粒度选择性生成，将配置项整合到统一的列表中，并移除独立的赞赏图开关。

## 实施步骤

### 1. 状态管理更新 (`src/store/useWeChatStandardizationStore.ts`)

*   **新增类型定义**: `EnabledTypes` 记录 P1-P5 的选中状态。
    ```typescript
    type EnabledTypes = {
      p1: boolean;
      p2: boolean;
      p3: boolean;
      appreciationGuide: boolean;
      appreciationThanks: boolean;
    };
    ```
*   **更新 State**:
    *   新增 `enabledTypes: EnabledTypes`，默认值为 `{ p1: true, p2: true, p3: true, appreciationGuide: false, appreciationThanks: false }`。
    *   移除 `enableAppreciation` 状态。
*   **新增 Action**:
    *   `toggleEnabledType(type: keyof EnabledTypes)`: 切换指定类型的选中状态。

### 2. 服务逻辑更新 (`src/services/wechatStandardizationService.ts`)

*   **修改 `generateAll`**:
    *   增加参数 `enabledTypes: EnabledTypes`。
    *   移除 `enableAppreciation` 参数。
    *   在生成流程中，根据 `enabledTypes` 判断是否执行每一步。
        *   如果 `enabledTypes.p1` 为 false，则跳过 P1 生成，result.banner 设为 null。
        *   以此类推 P2-P5。

### 3. 组件重构 (`src/components/StandardizationPromptEditor.tsx`)

*   **整合数据源**: 将原本的 `PROMPT_CONFIGS` 扩展为包含 P1-P5 所有类型。
    *   新增 P4 (赞赏引导图) 和 P5 (赞赏致谢图) 的配置。
*   **UI 结构变更**:
    *   渲染一个统一的列表，包含 5 个条目。
    *   每个条目头部增加 **Checkbox**。
        *   点击 Checkbox: 仅切换 `enabledTypes`，不展开/收起。
        *   点击头部其他区域: 展开/收起提示词编辑区。
    *   Checkbox 状态绑定 Store 中的 `enabledTypes`。
    *   **样式调整**: Checkbox 放在最左侧，与 Icon 并排。

### 4. 主面板更新 (`src/components/WeChatStandardizationPanel.tsx`)

*   **移除旧逻辑**:
    *   删除 `AppreciationPromptEditor` 的引用和渲染代码。
    *   删除原本的“赞赏图选项”复选框区域。
*   **数据传递**:
    *   从 Store 获取 `enabledTypes` 和 `toggleEnabledType`，传递给 `StandardizationPromptEditor`。
    *   调用 `generateAll` 时传递最新的 `enabledTypes`。
*   **提示词管理**:
    *   `StandardizationPromptEditor` 需要同时接收 P1-P3 和 P4-P5 的提示词及回调。建议将 props 简化为传递整个 `prompts` 对象和统一的 `onPromptChange`。

### 5. 验证与测试

*   **默认状态**: 打开面板，应看到 P1-P3 勾选，P4-P5 未勾选。
*   **交互测试**:
    *   勾选 P4，点击展开，编辑提示词，确认生效。
    *   取消勾选 P2，点击生成，确认结果中没有 P2，但有 P1, P3, P4。
*   **生成逻辑**: 确认后端 Service 正确跳过了未勾选的项目，且未勾选的项目在结果预览中不显示或显示为空。

## 任务清单 (Todo)

1.  更新 Store: 添加 `enabledTypes` 和 `toggleEnabledType`。
2.  更新 Service: 修改 `generateAll` 支持按需生成。
3.  重构 `StandardizationPromptEditor`: 统一 P1-P5 列表，添加复选框。
4.  更新 Panel: 移除旧赞赏图 UI，接入新逻辑。
